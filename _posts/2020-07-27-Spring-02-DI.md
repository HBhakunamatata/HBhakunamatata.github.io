---
layout: post
title:  "Spring-02-DI"
description: 
date:   2020-07-27
categories: Spring IoC
---
When you understand IoC, the operation of DI will become essential in Spring.

## DI (Dependency injection)

### 1. Constructor-based Dependency Injection

- Use the User.java as demo

```java
public class User {
    private String name;

    public User() {
        System.out.println("Non param constructor");
    }

    public User(String name) {
        this.name = name;
    }
}
```

- (1) name

```xml
<bean class="com.HB.pojo.User" id="user03">
    <constructor-arg name="name" value="user03"/>
<!--<constructor-arg ref="name" value="refId"/>-->
</bean>
```

- (2) index

```xml
<bean class="com.HB.pojo.User" id="user01">
    <constructor-arg index="0" value="user01"/>
</bean>
```

- (3) type (no commended)

```xml
<bean class="com.HB.pojo.User" id="user02">
    <constructor-arg type="java.lang.String" value="user02"/>
</bean>
```

### 2. Setter-based Dependency Injection

```java
@Data
public class Address {
    private String address;
}

@Data
public class Student {

    private String name;
    private Address address;
    private String [] books;
    private List<String> pencils;
    private Set<String> homework;
    private Properties info;
    private String wife;
    private Map<String, String> look;
}
```

- Write beans.xml for different types of fields in pojo:  
__[reference / array / list / set / null / map / properties]__

```xml
<bean class="com.HB.pojo.Address" id="address">
    <property name="address" value="青岛"/>
</bean>

<bean class="com.HB.pojo.Student" id="student">
    <property name="name" value="HB"/>

    <property name="address" ref="address"/>

    <property name="books">
        <array>
            <value>三国演义</value>
            <value>水浒传</value>
            <value>红楼梦</value>
            <value>西游记</value>
        </array>
    </property>

    <property name="pencils">
        <list>
            <value>red</value>
            <value>black</value>
            <value>white</value>
        </list>
    </property>

    <property name="homework">
        <set>
            <value>English</value>
            <value>Chinese</value>
            <value>Art</value>
        </set>
    </property>

    <property name="wife" >
        <null/>
    </property>

    <property name="info">
        <props>
            <prop key="ID">123456</prop>
            <prop key="hua">jiyi</prop>
        </props>
    </property>

    <property name="look">
        <map>
            <entry key="AA" value="aa"/>
            <entry key="DD" value="dd"/>
        </map>
    </property>
</bean>
```

### 3. Other two kinds of Dependency Injection

- (1) add xml binding

```xml
xmlns:p="http://www.springframework.org/schema/p"
xmlns:c="http://www.springframework.org/schema/c"
```

- (2) register the beans in beans.xml

```xml
<bean name="john-modern"
        class="com.example.Person"
        p:name="John Doe"
        p:spouse-ref="jane"/>

<bean id="beanTwo" class="x.y.ThingTwo"/>
<bean id="beanThree" class="x.y.ThingThree"/>

<!-- traditional declaration with optional argument names -->
<bean id="beanOne" class="x.y.ThingOne">
    <constructor-arg name="thingTwo" ref="beanTwo"/>
    <constructor-arg name="thingThree" ref="beanThree"/>
    <constructor-arg name="email" value="something@somewhere.com"/>
</bean>

<!-- c-namespace declaration with argument names -->
<bean id="beanOne" class="x.y.ThingOne" c:thingTwo-ref="beanTwo"
    c:thingThree-ref="beanThree" c:email="something@somewhere.com"/>

<!-- c-namespace index declaration -->
<bean id="beanOne" class="x.y.ThingOne" c:_0-ref="beanTwo" c:_1-ref="beanThree"
    c:_2="something@somewhere.com"/>
```


## Note :

- p and c need xml binding.
- c needs args-consturctor.